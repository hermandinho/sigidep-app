<div class="container">
  <form class="form" [formGroup]="form">
    <div class="p-fluid p-grid">
      <div class="p-field p-col-12 p-md-12">
        <div class="p-field">
          <label class="required">{{ "labels.exercise" | translate }}</label>
          <p-dropdown
            [autoDisplayFirst]="false"
            [options]="exercicesInprogressList"
            formControlName="exercice"
            optionLabel="code"
          >
            <ng-template let-option pTemplate="selectedItem">
              <div>
                <div>
                  {{ option.code }} / {{ option.startDate }} -
                  {{ option.endDate }}
                </div>
              </div>
            </ng-template>
            <ng-template let-option pTemplate="item">
              <div>
                <div>
                  {{ option.code }} / {{ option.startDate }} -
                  {{ option.endDate }}
                </div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>

      <div class="p-field p-col-12 p-md-12">
        <div class="p-field">
          <label class="required">{{ "labels.agent" | translate }}</label>
          <p-dropdown
            [autoDisplayFirst]="false"
            [options]="agentsList"
            formControlName="agent"
            optionLabel="matricule"
          >
            <ng-template let-option pTemplate="selectedItem">
              <div>
                <div>
                  {{ option.matricule }} - {{ option.nom + "" + option.prenom }}
                </div>
              </div>
            </ng-template>
            <ng-template let-option pTemplate="item">
              <div>
                <div>
                  {{ option.matricule }} - {{ option.nom + "" + option.prenom }}
                </div>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>

      <div class="p-field p-col-12 p-md-12">
        <div class="p-field">
          <label class="required">{{
            "labels.typeAccreditation" | translate
          }}</label>

          <p-dropdown
            [autoDisplayFirst]="false"
            [options]="['sub-program', 'administrative-unit']"
            formControlName="typeAccreditation"
          >
          </p-dropdown>
        </div>
      </div>

      <ng-container
        *ngIf="form.get('typeAccreditation')?.value === 'sub-program'"
      >
        <div class="p-field p-col-12 p-md-12">
          <div class="p-field">
            <label class="required">{{
              "labels.subProgram" | translate
            }}</label>
            <p-dropdown
              [autoDisplayFirst]="false"
              [options]="subProgramsList"
              formControlName="subProgram"
              optionLabel="labelFr"
            >
              <ng-template let-option pTemplate="selectedItem">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
              <ng-template let-option pTemplate="item">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>

        <div class="p-field p-col-12 p-md-4">
          <div class="p-field">
            <label class="required">{{ "labels.action" | translate }}</label>
            <p-dropdown
              [autoDisplayFirst]="false"
              [options]="form.get('subProgram')?.value?.actions"
              formControlName="action"
              optionLabel="labelFr"
            >
              <ng-template let-option pTemplate="selectedItem">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
              <ng-template let-option pTemplate="item">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>

        <div class="p-field p-col-12 p-md-4">
          <div class="p-field">
            <label class="required">{{ "labels.activity" | translate }}</label>
            <p-dropdown
              [autoDisplayFirst]="false"
              [options]="form.get('action')?.value?.activities"
              formControlName="activity"
              optionLabel="labelFr"
            >
              <ng-template let-option pTemplate="selectedItem">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
              <ng-template let-option pTemplate="item">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>

        <div class="p-field p-col-12 p-md-4">
          <div class="p-field">
            <label class="required">{{ "labels.task" | translate }}</label>
            <p-dropdown
              [autoDisplayFirst]="false"
              [options]="form.get('activity')?.value?.tasks"
              formControlName="task"
              optionLabel="labelFr"
            >
              <ng-template let-option pTemplate="selectedItem">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
              <ng-template let-option pTemplate="item">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>
      </ng-container>

      <ng-container
        *ngIf="form.get('typeAccreditation')?.value === 'administrative-unit'"
      >
        <div class="p-field p-col-12 p-md-12">
          <div class="p-field">
            <label class="required">{{
              "labels.administrativeUnit" | translate
            }}</label>
            <p-dropdown
              [autoDisplayFirst]="false"
              [options]="administrativeUnitList"
              formControlName="administrativeUnit"
              optionLabel="labelFr"
            >
              <ng-template let-option pTemplate="selectedItem">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
              <ng-template let-option pTemplate="item">
                <div>
                  <div>{{ option.code }} - {{ option.labelFr }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>
      </ng-container>
    </div>
  </form>

  <!---->
  <p-table [value]="imputationsOperationsList" responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr>
        <th>#</th>
        <th>Imputation</th>
        <th>Libell√© Operation</th>
        <th>Date debut</th>
        <th>Date fin</th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-product let-rowIndex="rowIndex">
      <tr>
        <td>{{ rowIndex }}</td>
        <td>{{ product.imputation }}</td>
        <td pEditableColumn>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                [disabled]="product.id"
                type="text"
                [(ngModel)]="product.labelOperation"
              />
            </ng-template>
            <ng-template pTemplate="output">
              {{ product.labelOperation }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td pEditableColumn>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                type="date"
                placeholder="dd-mm-yyyy"
                [disabled]="product.id"
                [(ngModel)]="product.dateDebut"
              />
            </ng-template>
            <ng-template pTemplate="output">
              {{ product.dateDebut | date }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td pEditableColumn>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                type="date"
                placeholder="dd-mm-yyyy"
                [disabled]="product.id"
                [(ngModel)]="product.dateFin"
              />
            </ng-template>
            <ng-template pTemplate="output">
              {{ product.dateFin | date }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <!-- <button
            (click)="edit(bankItem)"
            class="p-button-rounded p-button-success p-mr-2"
            icon="pi pi-pencil"
            pButton
            pRipple
          ></button> -->
          <button
            *ngIf="product.id"
            (click)="deleteAccreditation(product)"
            class="p-button-rounded p-button-warning"
            icon="pi pi-trash"
            [disabled]="loadingRemoveAccreditation"
            pButton
            pRipple
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <!---->

  <div class="footer p-mt-4">
    <button pButton class="p-mr-3 p-button-warning" (click)="close()">
      {{ "buttons.cancel" | translate }}
    </button>
    <button
      (click)="saveAccreditation()"
      [disabled]="!form?.valid || busy"
      [label]="
        'buttons.' + (busy ? 'busy' : isUpdateForm ? 'update' : 'save')
          | translate
      "
      pButton
    ></button>
  </div>
</div>
